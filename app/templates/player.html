{% extends "base.html" %}
{% block content %}
    <div class="container">

        <div class="text-block">
            <h1 style="font-size: 42px; font-weight: 900; margin-bottom: 3rem;">Did you like this recommendation?</h1>
        </div>
        
        <form id="ratingForm" action="{{ url_for('submit_ratings') }}" method="post">
            <div class="icon-container">
                <button type="submit" name="rating" value="love"><img src="{{ url_for('static', filename='assets/img/love.svg') }}" alt="extatic face"></button>
                <button type="submit" name="rating" value="like"><img src="{{ url_for('static', filename='assets/img/happy.svg') }}" alt="smiling face"></button>
                <button type="submit" name="rating" value="neutral"><img src="{{ url_for('static', filename='assets/img/neutral.svg') }}" alt="neutral face"></button>
                <button type="submit" name="rating" value="dislike"><img src="{{ url_for('static', filename='assets/img/sad.svg') }}" alt="sad face"></button>
                <button type="submit" name="rating" value="hate"><img src="{{ url_for('static', filename='assets/img/angry.svg') }}" alt="angry face"></button>
            </div>
        </form>
            

        <div class="music-player-block">
            <!-- AUDIO PLAYER -->
            <audio id="audioPlayer">
                Your browser does not support the audio element.
            </audio>

            <div>
                <button id="playPauseBtn" onclick="togglePlayPause()">
                    <img id="playIcon" src="{{ url_for('static', filename='assets/img/play.svg') }}" alt="Play button">
                    <img id="pauseIcon" src="{{ url_for('static', filename='assets/img/pause.svg') }}" alt="Pause button" style="display: none;">
                </button>
            </div>
            <!-- PROGRESS BAR -->
            <div class="progress-bar">
                <div class="progress"></div>
            </div>
        </div>        
    </div>

    <script>
        // Function to toggle play/pause
        function togglePlayPause() {
            var audioPlayer = document.getElementById('audioPlayer');
            var playIcon = document.getElementById('playIcon');
            var pauseIcon = document.getElementById('pauseIcon');

            if (audioPlayer.paused) {
                audioPlayer.play();
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'block';
            } else {
                audioPlayer.pause();
                playIcon.style.display = 'block';
                pauseIcon.style.display = 'none';
            }
        }
        
        // Function to play a random audio file after a delay seconds
        document.addEventListener('DOMContentLoaded', function() {
            var audioPlayer = document.getElementById('audioPlayer');

            // Seek to a specific position when the progress bar is clicked
            document.querySelector('.progress-bar').addEventListener('click', function(event) {
                var progressBar = event.currentTarget;
                var rect = progressBar.getBoundingClientRect();
                var offsetX = event.clientX - rect.left;
                var percentage = (offsetX / progressBar.offsetWidth) * 100;
                var newPosition = (percentage / 100) * audioPlayer.duration;
                audioPlayer.currentTime = newPosition;
            });

            // Update playback position and progress bar as audio plays
            audioPlayer.addEventListener('timeupdate', function() {
                var percentage = (audioPlayer.currentTime / audioPlayer.duration) * 100;
                document.querySelector('.progress').style.width = percentage + '%';
            });

            // Function to play a random audio file after a delay seconds
            setTimeout(function() {
                var recommendedSong = "{{ recommended_song }}";

                audioPlayer.src = "{{ url_for('static', filename='assets/excerpts/') }}" + recommendedSong;
                audioPlayer.play();
            }, 500); // 1000 milliseconds = 1 seconds
        });
    </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
{% endblock %}